{% extends 'layouts/base.html' %}
{% load static admin_soft%}

{% block content %}
  <div class="container-fluid my-3 py-3">
      <div id="data">
          <div class="row mb-5">
              <div class="col-lg-2">
                  <div class="card position-sticky top-1">
                      <ul class="nav flex-column bg-white border-radius-lg p-3">
                          <li class="nav-item">
                              <a class="nav-link text-body" data-scroll="" href="#screener">
                                  <i class="fas fa-magnifying-glass me-2"></i>
                                  <span class="text-sm">Screener Settings</span>
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="nav-link text-body" data-scroll="" href="#index">
                                  <i class="fas fa-table me-2"></i>
                                  <span class="text-sm">Index Data Refresh</span>
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="nav-link text-body" data-scroll="" href="#portfolio">
                                  <i class="fas fa-table me-2"></i>
                                  <span class="text-sm">Portfolio Data Refresh</span>
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="nav-link text-body" data-scroll="" href="#watch">
                                  <i class="fas fa-list-check me-2"></i>
                                  <span class="text-sm">Watch lists</span>
                              </a>
                          </li>
                      </ul>
                  </div>
              </div>
              <div class="col-lg-10 mt-lg-0 mt-4">
                  <!--Index-->
                  <div class="card mt-4" id="index">
                      <div class="card-header">
                          <div class="row">
                              <div class="col-2">
                                  <h5>Index refresh</h5>
                              </div>
                              <div class="col-2">
                                  <button class="btn bg-gradient-primary mb-0 mt-lg-auto w-100" type="button" id="refreshButton" onclick="refreshTask('index_input','index_period_select', 'index_interval_select')">Refresh</button>
                              </div>
                          </div>
                      </div>
                      <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-2">
                                    <label>Period</label>
                                    <select class="form-select" id="index_period_select">
                                        <option value="max" >max</option>
                                        <option value="1d">1d</option>
                                        <option value="5d" selected>5d</option>
                                        <option value="1mo">1mo</option>
                                        <option value="3mo">3mo</option>
                                        <option value="6mo">6mo</option>
                                        <option value="1y">1y</option>
                                        <option value="2y">2y</option>
                                        <option value="5y">5y</option>
                                        <option value="10y">10y</option>
                                        <option value="ytd">ytd</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label>Interval</label>
                                    <select class="form-select" id="index_interval_select">
                                        <option value="1m">1m</option>
                                        <option value="2m">2m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="60m">60m</option>
                                        <option value="90m">90m</option>
                                        <option value="1h">1h</option>
                                        <option value="1d" selected>1d</option>
                                        <option value="5d">5d</option>
                                        <option value="1wk">1wk</option>
                                        <option value="1mo">1mo</option>
                                        <option value="3mo">3mo</option>
                                    </select>
                                </div>
                                <div class="col-8">
                                  <label>Symbols</label>
                                  <input type="text" class="form-control" id="index_input" placeholder="Enter symbols separated by commas" value="{{ index }}">
                                </div>
                            </div>
                      </div>
                  </div>
                  <!--Index & Open Position-->
                  <div class="card mt-4" id="portfolio">
                      <div class="card-header">
                          <div class="row">
                              <div class="col-2">
                                  <h5>Index & Open</h5>
                              </div>
                              <div class="col-2">
                                  <button class="btn bg-gradient-primary mb-0 mt-lg-auto w-100" type="button" id="refreshButton" onclick="refreshTask('holding_input','holding_period_select', 'holding_interval_select')">Refresh</button>
                              </div>
                          </div>
                      </div>
                      <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-2">
                                    <label>Period</label>
                                    <select class="form-select" id="holding_period_select">
                                        <option value="max" >max</option>
                                        <option value="1d">1d</option>
                                        <option value="5d" selected>5d</option>
                                        <option value="1mo">1mo</option>
                                        <option value="3mo">3mo</option>
                                        <option value="6mo">6mo</option>
                                        <option value="1y">1y</option>
                                        <option value="2y">2y</option>
                                        <option value="5y">5y</option>
                                        <option value="10y">10y</option>
                                        <option value="ytd">ytd</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label>Interval</label>
                                    <select class="form-select" id="holding_interval_select">
                                        <option value="1m">1m</option>
                                        <option value="2m">2m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="60m">60m</option>
                                        <option value="90m">90m</option>
                                        <option value="1h">1h</option>
                                        <option value="1d" selected>1d</option>
                                        <option value="5d">5d</option>
                                        <option value="1wk">1wk</option>
                                        <option value="1mo">1mo</option>
                                        <option value="3mo">3mo</option>
                                    </select>
                                </div>
                                <div class="col-8">
                                  <label>Symbols</label>
                                  <input type="text" class="form-control" id="holding_input" placeholder="Enter symbols separated by commas" value="{{ holdings }}">
                                </div>
                            </div>
                      </div>
                  </div>
                  <!--All Symbols-->
                  <div class="card mt-4" id="portfolio">
                      <div class="card-header">
                          <div class="row">
                              <div class="col-2">
                                  <h5>All Symbols</h5>
                              </div>
                              <div class="col-2">
                                  <button class="btn bg-gradient-primary mb-0 mt-lg-auto w-100" type="button" id="refreshButton" onclick="refreshTask('all_input','all_period_select', 'all_interval_select')">Refresh</button>
                              </div>
                          </div>
                      </div>
                      <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-2">
                                    <label>Period</label>
                                    <select class="form-select" id="all_period_select">
                                        <option value="max" >max</option>
                                        <option value="1d">1d</option>
                                        <option value="5d" selected>5d</option>
                                        <option value="1mo">1mo</option>
                                        <option value="3mo">3mo</option>
                                        <option value="6mo">6mo</option>
                                        <option value="1y">1y</option>
                                        <option value="2y">2y</option>
                                        <option value="5y">5y</option>
                                        <option value="10y">10y</option>
                                        <option value="ytd">ytd</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label>Interval</label>
                                    <select class="form-select" id="all_interval_select">
                                        <option value="1m">1m</option>
                                        <option value="2m">2m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="60m">60m</option>
                                        <option value="90m">90m</option>
                                        <option value="1h">1h</option>
                                        <option value="1d" selected>1d</option>
                                        <option value="5d">5d</option>
                                        <option value="1wk">1wk</option>
                                        <option value="1mo">1mo</option>
                                        <option value="3mo">3mo</option>
                                    </select>
                                </div>
                                <div class="col-8">
                                  <label>Symbols</label>
                                  <input type="text" class="form-control" id="all_input" placeholder="Enter symbols separated by commas" value="{{ all_symbols }}">
                                </div>
                            </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
    {% include 'includes/footer.html' %}
  </div>
  </div>
{% endblock content %}

{% block extra_js %}

<script src="{% static 'assets/js/plugins/choices.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/countup.min.js' %}"></script>
<script>
    function refreshTask(input,period_select,interval_select) {
        let symbolInput = document.getElementById(input).value;
        symbolInput = symbolInput.replace(/,/g, '|'); // Replace commas with pipe characters
        const period = document.getElementById(period_select).value; // Get the selected period
        const interval = document.getElementById(interval_select).value; // Get the selected interval
        refreshSymbol(symbolInput,period,interval, '{{ csrf_token }}')
    }


    {% if messages %}
        const currentTime = new Date().toLocaleTimeString();
        {% for message in messages %}
            console.log('{{ message }}');

            const level = {% if message.level_tag == 'alert-success' %} 'success' {% else %} 'error' {% endif %}
            const title = '{{ message.extra_tags }}'; // Replace with the actual task name if needed
            const content = '{{ message.message }}';

            showNotification(level, title, content, currentTime);
            {#showNotification('error', task_name, data.error, currentTime);#}

        {% endfor %}
    {% endif %}




</script>

{% endblock extra_js %}